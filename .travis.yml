launguage: bash
sudo: enabled
git:
  submodules: false

before_script:
  - git clone --depth=1 --branch=master https://github.com/takezoh/ArchLinux-WSL.git
  - sed -i -e 's/^set -e$/set -ex/' ./ArchLinux-WSL/create-targz.sh
  - ./ArchLinux-WSL/create-targz.sh

script:
  - mkdir rootfs
  - tar zxf ArchLinux-WSL/install.tar.gz -C rootfs
  - cp /etc/resolv.conf rootfs/etc/resolv.conf
  # - sudo mount --bind rootfs rootfs
  # - sudo mount --bind . rootfs/mnt
  # - sudo mount -t proc /proc rootfs/proc
  # - sudo mount --rbind /sys rootfs/sys
  # - sudo mount --rbind /dev rootfs/dev
  # - sudo mount --rbind /run rootfs/run
  # - sudo chroot rootfs useradd -G wheel --no-user-group --create-home --no-log-init -- admin
  # - sudo chroot rootfs su - admin -c "/mnt/install.sh"
  # - sudo chroot rootfs pacman -Scc
  # - sudo umount -l rootfs
  - rm -rf rootfs/tmp/*
  - rm -rf rootfs/var/cache/pacman/pkg/*
  - echo "# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line." > rootfs/etc/resolv.conf
  - cd rootfs && sudo tar --ignore-failed-read -czvf ../arch.install.tar.gz *

deploy:
  provider: releases
  api_key:
    secure: "l1C1BtQrzh9uGVmUctzky92WstOYCNU75jyAdlANVGMBk/fs/jvZ8wpaJap1DPFDB3Uywal0F0Lhx3xU0sRH4BINkG/0eIc0+Fwntzt2RAL8mScmr+J3US/w4f4CuLPNeqSfPtWJhlkJBnJW8q2AHsl5dTHC9QdQbFXSDosr0VbX3IsuuKDhWOqbVj+gJPaf+Fagpva0vYGmX9Qd2uCrS4U6zKt2/DuU2d2ZP1+dHh93r10PZUx3V4EF7fyCxz0Lqq4nAPbJTRJ3FcNSJAeH8+S/KPV7cLtaNWsosPtnv44mh47wQz5jTr7i7VTMM0c6xGI3WqYSFRlpYQKyuoNlEWQrNX3iuQm3kUW9veHivDz+z2rJS7+u43kAE6l3tbRLjQGiThIGeXEZbuO9zn3sRraH+kEd0GpPQc0NqYX8ma/mZOfuBNCSIGmrN8U/DYMEDl3oE31LJq3aoaDWfcNeicBMwCQ8m3Y/nd40Rlz9GYlNBPDm9ijd4mhQTA/oBI4eOUd7u1fSUm4+RI9GsUE4UPgXiaLG8vnZ3TrlX8ssSPT7tTTnTMckLkmNJ4WjuqPZBrs6pzMX5WJ+JXye+IwmxiY7yhZeb/CVMPdSWBmHEqiMsAOZZrNuOQ//8RLoCtHZjf0HnuQo3oujvoelrG2OCHU9JK0B6gOY6VL9MXMm4WM="
  file:
    - "arch.install.tar.gz"
  on:
    repo: Takezoh/dotfiles
    # tags: true
    all_branches: true
  skip_cleanup: true
